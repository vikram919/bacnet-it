<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Time.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bacnet-it</a> &gt; <a href="index.source.html" class="el_package">ch.fhnw.bacnetit.samplesandtests.api.encoding.type.primitive</a> &gt; <span class="el_source">Time.java</span></div><h1>Time.java</h1><pre class="source lang-java linenums">/*******************************************************************************
 * ============================================================================
 * GNU General Public License
 * ============================================================================
 *
 * Copyright (C) 2017 University of Applied Sciences and Arts,
 * Northwestern Switzerland FHNW,
 * Institute of Mobile and Distributed Systems.
 * All rights reserved.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see http://www.gnu.orglicenses.
 *******************************************************************************/
package ch.fhnw.bacnetit.samplesandtests.api.encoding.type.primitive;

import java.util.Calendar;
import java.util.GregorianCalendar;

import ch.fhnw.bacnetit.samplesandtests.api.encoding.util.ByteQueue;

/**
 * ASHRAE Standard 135-2012 Clause 20.2.13 Encoding of a Time Value p. 631&lt;br&gt;
 * &lt;br&gt;
 * The encoding of a time value shall be primitive, with four contents octets.
 * &lt;br&gt;
 * Unless otherwise specified (e.g., UTC time), a time value generated by a
 * device&lt;br&gt;
 * shall be a local time.&lt;br&gt;
 * &lt;br&gt;
 * Time values shall be encoded in the contents octets as four binary integers.
 * &lt;br&gt;
 * The first contents octet shall represent the hour, in the 24-hour system&lt;br&gt;
 * (1 P.M. = D'13'); the second octet shall represent the minute of the hour;
 * &lt;br&gt;
 * the third octet shall represent the second of the minute; and the fourth&lt;br&gt;
 * octet shall represent the fractional part of the second in hundredths of a
 * &lt;br&gt;
 * second. A value of X'FF' = D'255' in any of the four octets shall indicate
 * &lt;br&gt;
 * that the corresponding value is unspecified and shall be considered a&lt;br&gt;
 * wildcard when matching times. If all four octets = X'FF', the corresponding
 * &lt;br&gt;
 * time may be interpreted as &quot;any&quot; or &quot;don't care.&quot;&lt;br&gt;
 * &lt;br&gt;
 * Neither an unspecified time nor a time pattern shall be used in time values
 * &lt;br&gt;
 * that convey actual time, such as those presented by the Local_Time property
 * &lt;br&gt;
 * of the Device object or in a TimeSynchronization-Request.&lt;br&gt;
 * &lt;br&gt;
 * Example: Application-tagged specific time value&lt;br&gt;
 * ASN.1 = Time&lt;br&gt;
 * Value = 17:35:45.17 (= 5:35:45.17 P.M.)&lt;br&gt;
 * Application Tag = Time (Tag Number = 11)&lt;br&gt;
 * Encoded Tag = X'B4'&lt;br&gt;
 * Encoded Data = X'11232D11'&lt;br&gt;
 */
public class Time extends Primitive {
    private static final long serialVersionUID = -5256831366663750858L;

    public static final byte TYPE_ID = 11;

    private final int hour;

    private final int minute;

    private final int second;

    private final int hundredth;

    public Time(final int hour, final int minute, final int second,
<span class="nc" id="L81">            final int hundredth) {</span>
<span class="nc" id="L82">        this.hour = hour;</span>
<span class="nc" id="L83">        this.minute = minute;</span>
<span class="nc" id="L84">        this.second = second;</span>
<span class="nc" id="L85">        this.hundredth = hundredth;</span>
<span class="nc" id="L86">    }</span>

    public Time() {
<span class="nc" id="L89">        this(new GregorianCalendar());</span>
<span class="nc" id="L90">    }</span>

<span class="fc" id="L92">    public Time(final GregorianCalendar now) {</span>
<span class="fc" id="L93">        this.hour = now.get(Calendar.HOUR_OF_DAY);</span>
<span class="fc" id="L94">        this.minute = now.get(Calendar.MINUTE);</span>
<span class="fc" id="L95">        this.second = now.get(Calendar.SECOND);</span>
<span class="fc" id="L96">        this.hundredth = now.get(Calendar.MILLISECOND) / 10;</span>
<span class="fc" id="L97">    }</span>

    public boolean isHourUnspecified() {
<span class="nc bnc" id="L100" title="All 2 branches missed.">        return hour == 255;</span>
    }

    public int getHour() {
<span class="nc" id="L104">        return hour;</span>
    }

    public boolean isMinuteUnspecified() {
<span class="nc bnc" id="L108" title="All 2 branches missed.">        return minute == 255;</span>
    }

    public int getMinute() {
<span class="nc" id="L112">        return minute;</span>
    }

    public boolean isSecondUnspecified() {
<span class="nc bnc" id="L116" title="All 2 branches missed.">        return second == 255;</span>
    }

    public int getSecond() {
<span class="nc" id="L120">        return second;</span>
    }

    public boolean isHundredthUnspecified() {
<span class="nc bnc" id="L124" title="All 2 branches missed.">        return hundredth == 255;</span>
    }

    public int getHundredth() {
<span class="nc" id="L128">        return hundredth;</span>
    }

    /**
     * @param that
     *            The time with which to compare this
     * @return true if this less than that.
     */
    public boolean before(final Time that) {
<span class="nc bnc" id="L137" title="All 4 branches missed.">        if (!this.isHourUnspecified() &amp;&amp; !that.isHourUnspecified()) {</span>
<span class="nc bnc" id="L138" title="All 2 branches missed.">            if (this.hour &lt; that.hour) {</span>
<span class="nc" id="L139">                return true;</span>
            }
<span class="nc bnc" id="L141" title="All 2 branches missed.">            if (this.hour &gt; that.hour) {</span>
<span class="nc" id="L142">                return false;</span>
            }
        }

<span class="nc bnc" id="L146" title="All 4 branches missed.">        if (!this.isMinuteUnspecified() &amp;&amp; !that.isMinuteUnspecified()) {</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">            if (this.minute &lt; that.minute) {</span>
<span class="nc" id="L148">                return true;</span>
            }
<span class="nc bnc" id="L150" title="All 2 branches missed.">            if (this.minute &gt; that.minute) {</span>
<span class="nc" id="L151">                return false;</span>
            }
        }

<span class="nc bnc" id="L155" title="All 4 branches missed.">        if (!this.isSecondUnspecified() &amp;&amp; !that.isSecondUnspecified()) {</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">            if (this.second &lt; that.second) {</span>
<span class="nc" id="L157">                return true;</span>
            }
<span class="nc bnc" id="L159" title="All 2 branches missed.">            if (this.second &gt; that.second) {</span>
<span class="nc" id="L160">                return false;</span>
            }
        }

<span class="nc bnc" id="L164" title="All 4 branches missed.">        if (this.isHundredthUnspecified() || that.isHundredthUnspecified()) {</span>
<span class="nc" id="L165">            return false;</span>
        }

<span class="nc bnc" id="L168" title="All 2 branches missed.">        return this.hundredth &lt; that.hundredth;</span>
    }

    /**
     * @param that
     *            The time with which to compare this
     * @return true if this greater or equal than that
     */
    public boolean after(final Time that) {
<span class="nc bnc" id="L177" title="All 4 branches missed.">        if (!this.isHourUnspecified() &amp;&amp; !that.isHourUnspecified()) {</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">            if (this.hour &gt; that.hour) {</span>
<span class="nc" id="L179">                return true;</span>
            }
<span class="nc bnc" id="L181" title="All 2 branches missed.">            if (this.hour &lt; that.hour) {</span>
<span class="nc" id="L182">                return false;</span>
            }
        }

<span class="nc bnc" id="L186" title="All 4 branches missed.">        if (!this.isMinuteUnspecified() &amp;&amp; !that.isMinuteUnspecified()) {</span>
<span class="nc bnc" id="L187" title="All 2 branches missed.">            if (this.minute &gt; that.minute) {</span>
<span class="nc" id="L188">                return true;</span>
            }
<span class="nc bnc" id="L190" title="All 2 branches missed.">            if (this.minute &lt; that.minute) {</span>
<span class="nc" id="L191">                return false;</span>
            }
        }

<span class="nc bnc" id="L195" title="All 4 branches missed.">        if (!this.isSecondUnspecified() &amp;&amp; !that.isSecondUnspecified()) {</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">            if (this.second &gt; that.second) {</span>
<span class="nc" id="L197">                return true;</span>
            }
<span class="nc bnc" id="L199" title="All 2 branches missed.">            if (this.second &lt; that.second) {</span>
<span class="nc" id="L200">                return false;</span>
            }
        }

<span class="nc bnc" id="L204" title="All 4 branches missed.">        if (this.isHundredthUnspecified() || that.isHundredthUnspecified()) {</span>
<span class="nc" id="L205">            return true;</span>
        }

<span class="nc bnc" id="L208" title="All 2 branches missed.">        return this.hundredth &gt;= that.hundredth;</span>
    }

    //
    // Reading and writing
    //
<span class="nc" id="L214">    public Time(final ByteQueue queue) {</span>
<span class="nc" id="L215">        readTag(queue);</span>
<span class="nc" id="L216">        hour = queue.popU1B();</span>
<span class="nc" id="L217">        minute = queue.popU1B();</span>
<span class="nc" id="L218">        second = queue.popU1B();</span>
<span class="nc" id="L219">        hundredth = queue.popU1B();</span>
<span class="nc" id="L220">    }</span>

    @Override
    public void writeImpl(final ByteQueue queue) {
<span class="fc" id="L224">        queue.push((byte) hour);</span>
<span class="fc" id="L225">        queue.push((byte) minute);</span>
<span class="fc" id="L226">        queue.push((byte) second);</span>
<span class="fc" id="L227">        queue.push((byte) hundredth);</span>
<span class="fc" id="L228">    }</span>

    @Override
    protected long getLength() {
<span class="fc" id="L232">        return 4;</span>
    }

    @Override
    protected byte getTypeId() {
<span class="fc" id="L237">        return TYPE_ID;</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L242">        final int PRIME = 31;</span>
<span class="nc" id="L243">        int result = 1;</span>
<span class="nc" id="L244">        result = PRIME * result + hour;</span>
<span class="nc" id="L245">        result = PRIME * result + hundredth;</span>
<span class="nc" id="L246">        result = PRIME * result + minute;</span>
<span class="nc" id="L247">        result = PRIME * result + second;</span>
<span class="nc" id="L248">        return result;</span>
    }

    @Override
    public boolean equals(final Object obj) {
<span class="nc bnc" id="L253" title="All 2 branches missed.">        if (this == obj) {</span>
<span class="nc" id="L254">            return true;</span>
        }
<span class="nc bnc" id="L256" title="All 2 branches missed.">        if (obj == null) {</span>
<span class="nc" id="L257">            return false;</span>
        }
<span class="nc bnc" id="L259" title="All 2 branches missed.">        if (getClass() != obj.getClass()) {</span>
<span class="nc" id="L260">            return false;</span>
        }
<span class="nc" id="L262">        final Time other = (Time) obj;</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">        if (hour != other.hour) {</span>
<span class="nc" id="L264">            return false;</span>
        }
<span class="nc bnc" id="L266" title="All 2 branches missed.">        if (hundredth != other.hundredth) {</span>
<span class="nc" id="L267">            return false;</span>
        }
<span class="nc bnc" id="L269" title="All 2 branches missed.">        if (minute != other.minute) {</span>
<span class="nc" id="L270">            return false;</span>
        }
<span class="nc bnc" id="L272" title="All 2 branches missed.">        if (second != other.second) {</span>
<span class="nc" id="L273">            return false;</span>
        }
<span class="nc" id="L275">        return true;</span>
    }

    @Override
    public String toString() {
<span class="nc" id="L280">        return Integer.toString(hour) + &quot;:&quot; + Integer.toString(minute) + &quot;:&quot;</span>
<span class="nc" id="L281">                + Integer.toString(second) + &quot;.&quot; + hundredth;</span>

    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>